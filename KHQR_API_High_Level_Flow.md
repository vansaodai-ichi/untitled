# KHQR API High-Level Flow: QR Generation & Payment Confirmation

**Version:** 1.0  
**Date:** October 7, 2025  
**Scope:** KHQR Payment Integration â€“ Dai-Ichi, Bank Partner, Customer

---

## Participants
- **Customer**: End-user initiating payment
- **Bank Partner**: Bank providing KHQR payment infrastructure
- **Dai-Ichi**: Insurance provider integrating KHQR payments

---

## 1. KHQR Code Generation Flow

```mermaid
sequenceDiagram
    participant Customer
    participant BankPartner as Bank Partner
    participant DaiIchi as Dai-Ichi

    Customer->>BankPartner: 1. Request payment info (policy/bill)
    BankPartner->>DaiIchi: 2. Fetch payment details
    DaiIchi-->>BankPartner: 3. Return payment details
    BankPartner-->>Customer: 4. Return payment info (amount, currency, etc.)
    Customer->>BankPartner: 5. Request KHQR code generation
    BankPartner->>DaiIchi: 6. Request KHQR code (with payment details)
    DaiIchi-->>BankPartner: 7. Return KHQR code (Base64 image)
    BankPartner-->>Customer: 8. Present KHQR code for payment
```

---

## 2. KHQR Payment Confirmation Flow

```mermaid
sequenceDiagram
    participant Customer
    participant BankPartner as Bank Partner
    participant DaiIchi as Dai-Ichi

    Customer->>BankPartner: 1. Scan KHQR & initiate payment
    BankPartner->>BankPartner: 2. Process payment (debit customer)
    BankPartner->>DaiIchi: 3. Notify payment confirmation (webhook)
    DaiIchi-->>BankPartner: 4. Acknowledge confirmation
    DaiIchi->>BankPartner: 5. (Optional) Query payment status for verification
    BankPartner-->>DaiIchi: 6. Return payment status detail
    DaiIchi->>DaiIchi: 7. Update internal records
    BankPartner-->>Customer: 8. Inform payment result
```

---

## Flow Summary
- **QR Generation**: Customer requests payment info, receives KHQR code via Bank Partner, generated by Dai-Ichi.
- **Payment Confirmation**: Customer pays by scanning KHQR, Bank Partner processes payment, notifies Dai-Ichi, and both parties verify and update records.

---

**Contact:** Payment Hub Development Team  
**Support:** support@daiichi.com.kh
